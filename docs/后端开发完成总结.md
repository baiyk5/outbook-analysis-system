# OutBook åç«¯å¼€å‘å®Œæˆæ€»ç»“

## ğŸ‰ é¡¹ç›®æ¦‚è¿°

å·²æˆåŠŸå®Œæˆ OutBook é¡¹ç›®ç®¡ç†ç³»ç»Ÿçš„åç«¯å¼€å‘ã€å‰åç«¯å¯¹æ¥å’Œéƒ¨ç½²é…ç½®ã€‚ç³»ç»Ÿç°åœ¨å¯ä»¥ä»é£ä¹¦å¤šç»´è¡¨æ ¼è·å–çœŸå®æ•°æ®ï¼Œå¹¶æä¾›å®Œæ•´çš„ API æœåŠ¡ã€‚

---

## âœ… å®Œæˆå†…å®¹

### 1. åç«¯é¡¹ç›®æ¶æ„

åˆ›å»ºäº†å®Œæ•´çš„ Node.js + TypeScript åç«¯é¡¹ç›®ï¼š

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts     # ç»Ÿä¸€é…ç½®ï¼ˆé£ä¹¦ã€Redisã€ç¼“å­˜ç­‰ï¼‰
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ feishu.ts    # é£ä¹¦ SDK å°è£…
â”‚   â”‚   â”œâ”€â”€ cache.ts     # Redis ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ project.service.ts      # é¡¹ç›®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ statistics.service.ts   # ç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ report.service.ts       # æŠ¥å‘ŠæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ knowledge.service.ts    # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”‚   â””â”€â”€ workplace.service.ts    # å·¥ä½œå°æœåŠ¡
â”‚   â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â””â”€â”€ index.ts     # API æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ index.ts     # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ transform.ts # æ•°æ®è½¬æ¢
â”‚   â””â”€â”€ app.ts           # åº”ç”¨å…¥å£
â”œâ”€â”€ scripts/             # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ setup-feishu.js  # é£ä¹¦é…ç½®å‘å¯¼
â”‚   â””â”€â”€ test-feishu.ts   # é£ä¹¦è¿æ¥æµ‹è¯•
â”œâ”€â”€ docs/                # æ–‡æ¡£
â”‚   â”œâ”€â”€ é£ä¹¦å¯¹æ¥æŒ‡å—.md
â”‚   â””â”€â”€ å¿«é€Ÿå¼€å§‹.md
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .env                 # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ Dockerfile           # Docker é…ç½®
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### 2. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### âœ… é£ä¹¦ SDK é›†æˆ
- ä½¿ç”¨å®˜æ–¹ `@larksuiteoapi/node-sdk`
- å°è£…äº†å¸¸ç”¨ API æ–¹æ³•ï¼š
  - `getTableRecords()` - è·å–è¡¨æ ¼è®°å½•ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
  - `getTableRecord()` - è·å–å•æ¡è®°å½•
  - `createTableRecord()` - åˆ›å»ºè®°å½•
  - `updateTableRecord()` - æ›´æ–°è®°å½•
  - `deleteTableRecord()` - åˆ é™¤è®°å½•
  - `searchTableRecords()` - æœç´¢è®°å½•

#### âœ… ç¼“å­˜ç³»ç»Ÿ
- Redis ä¸»ç¼“å­˜ + å†…å­˜ç¼“å­˜é™çº§
- ä¸‰çº§ TTL ç­–ç•¥ï¼š
  - çŸ­æœŸï¼ˆ5åˆ†é’Ÿï¼‰ï¼šé¡¹ç›®ã€Bugã€å·¥å•åˆ—è¡¨
  - ä¸­æœŸï¼ˆ30åˆ†é’Ÿï¼‰ï¼šç»Ÿè®¡æ•°æ®ã€æŠ¥å‘Š
  - é•¿æœŸï¼ˆ1å°æ—¶ï¼‰ï¼šè¯äº‘ã€é…ç½®æ•°æ®
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜

#### âœ… æ•°æ®è½¬æ¢
- é£ä¹¦å­—æ®µ â†’ å‰ç«¯æ ¼å¼çš„å®Œæ•´è½¬æ¢
- æ”¯æŒå¤šç§å­—æ®µç±»å‹ï¼š
  - æ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸ
  - å•é€‰ã€å¤šé€‰
  - äººå‘˜ã€äººå‘˜ç»„
  - å…³è”å­—æ®µ
- æ•°æ®èšåˆå’Œè®¡ç®—

#### âœ… API æ¥å£

**ç”¨æˆ·ç›¸å…³ï¼š**
- `POST /api/login/account` - ç™»å½•
- `GET /api/currentUser` - è·å–å½“å‰ç”¨æˆ·
- `POST /api/login/outLogin` - ç™»å‡º
- `GET /api/notices` - è·å–é€šçŸ¥

**é¡¹ç›®ç›¸å…³ï¼š**
- `GET /api/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `GET /api/projects/:id` - è·å–å•ä¸ªé¡¹ç›®

**ç»Ÿè®¡ç›¸å…³ï¼š**
- `GET /api/statistics/overview` - ç»Ÿè®¡æ¦‚è§ˆ
- `GET /api/statistics/trend` - è¶‹åŠ¿æ•°æ®
- `GET /api/statistics/wordcloud` - å­¦æ ¡è¯äº‘
- `GET /api/statistics/bug-analysis` - Bug åˆ†æ
- `GET /api/statistics/ticket-analysis` - å·¥å•åˆ†æ
- `GET /api/statistics/financial` - è´¢åŠ¡æ•°æ®

**æŠ¥å‘Šç›¸å…³ï¼š**
- `GET /api/reports/monthly` - æœˆåº¦æŠ¥å‘Š
- `GET /api/reports/quarterly` - å­£åº¦æŠ¥å‘Š
- `POST /api/reports/generate` - AI ç”ŸæˆæŠ¥å‘Š

**çŸ¥è¯†åº“ç›¸å…³ï¼š**
- `GET /api/knowledge/documents` - æ–‡æ¡£åˆ—è¡¨
- `GET /api/knowledge/stats` - çŸ¥è¯†åº“ç»Ÿè®¡

**å·¥ä½œå°ç›¸å…³ï¼š**
- `GET /api/workplace/notices` - é¡¹ç›®é€šçŸ¥
- `GET /api/workplace/activities` - æ´»åŠ¨åˆ—è¡¨
- `GET /api/workplace/charts` - å›¾è¡¨æ•°æ®

**åˆ†æç›¸å…³ï¼š**
- `GET /api/analysis/charts` - åˆ†æå›¾è¡¨æ•°æ®

**å¥åº·æ£€æŸ¥ï¼š**
- `GET /health` - å¥åº·æ£€æŸ¥

### 3. å‰ç«¯å¯¹æ¥

#### âœ… ç¯å¢ƒé…ç½®
- åˆ›å»º `.env.development` é…ç½®æ–‡ä»¶
- æ”¯æŒ Mock æ•°æ® / çœŸå® API åˆ‡æ¢
- é…ç½®ä»£ç†è½¬å‘

#### âœ… ä»£ç†é…ç½®
- æ›´æ–° `config/proxy.ts`
- å°† `/api/*` è¯·æ±‚ä»£ç†åˆ°åç«¯æœåŠ¡
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½®

### 4. éƒ¨ç½²é…ç½®

#### âœ… Docker éƒ¨ç½²
- åç«¯ Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
- å‰ç«¯ Dockerfileï¼ˆNginx æä¾›é™æ€æ–‡ä»¶ï¼‰
- Docker Compose é…ç½®ï¼ˆå‰ç«¯ + åç«¯ + Redisï¼‰
- å¥åº·æ£€æŸ¥é…ç½®

#### âœ… Nginx é…ç½®
- SPA è·¯ç”±æ”¯æŒ
- API ä»£ç†
- Gzip å‹ç¼©
- é™æ€èµ„æºç¼“å­˜
- å®‰å…¨å¤´é…ç½®

### 5. å·¥å…·å’Œæ–‡æ¡£

#### âœ… é…ç½®å·¥å…·
- `npm run setup` - äº¤äº’å¼é£ä¹¦é…ç½®å‘å¯¼
- `npm run test:feishu` - é£ä¹¦è¿æ¥æµ‹è¯•è„šæœ¬

#### âœ… å®Œæ•´æ–‡æ¡£
- `backend/README.md` - åç«¯é¡¹ç›®è¯´æ˜
- `backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md` - é£ä¹¦é…ç½®è¯¦ç»†æŒ‡å—
- `backend/docs/å¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- `docs/å‰åç«¯å¯¹æ¥æŒ‡å—.md` - å‰åç«¯è”è°ƒæŒ‡å—
- `docs/å®Œæ•´éƒ¨ç½²æŒ‡å—.md` - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- `docs/åç«¯å¼€å‘å®Œæˆæ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æœ¬åœ°å¼€å‘

#### 1. é…ç½®é£ä¹¦

```bash
cd backend
npm install
npm run setup  # äº¤äº’å¼é…ç½®å‘å¯¼
npm run test:feishu  # æµ‹è¯•è¿æ¥
```

#### 2. å¯åŠ¨åç«¯

```bash
npm run dev
# åç«¯æœåŠ¡: http://localhost:3000
```

#### 3. å¯åŠ¨å‰ç«¯

```bash
cd ..
npm run dev
# å‰ç«¯æœåŠ¡: http://localhost:8000
```

### ç”Ÿäº§éƒ¨ç½²

#### æ–¹å¼ 1: Docker Composeï¼ˆæ¨èï¼‰

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
nano backend/.env  # å¡«å…¥é£ä¹¦é…ç½®

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 4. è®¿é—®ç³»ç»Ÿ
# http://your-server-ip
```

#### æ–¹å¼ 2: PM2

```bash
# åç«¯
cd backend
npm run build
pm2 start dist/app.js --name outbook-backend

# å‰ç«¯
cd ..
npm run build
# å°† dist ç›®å½•éƒ¨ç½²åˆ° Nginx
```

---

## ğŸ“Š æŠ€æœ¯æ ˆ

### åç«¯
- **Node.js 18** - è¿è¡Œç¯å¢ƒ
- **TypeScript** - ç±»å‹å®‰å…¨
- **Express** - Web æ¡†æ¶
- **@larksuiteoapi/node-sdk** - é£ä¹¦å®˜æ–¹ SDK
- **Redis** - ç¼“å­˜
- **dayjs** - æ—¥æœŸå¤„ç†
- **helmet** - å®‰å…¨
- **compression** - å‹ç¼©
- **morgan** - æ—¥å¿—

### å‰ç«¯
- **UmiJS 4** - React æ¡†æ¶
- **React 19** - UI åº“
- **Ant Design Pro** - ä¼ä¸šçº§ UI
- **TypeScript** - ç±»å‹å®‰å…¨

### éƒ¨ç½²
- **Docker** - å®¹å™¨åŒ–
- **Docker Compose** - ç¼–æ’
- **Nginx** - Web æœåŠ¡å™¨
- **PM2** - è¿›ç¨‹ç®¡ç†

---

## ğŸ¯ é£ä¹¦è¡¨æ ¼ç»“æ„

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹é£ä¹¦å¤šç»´è¡¨æ ¼ï¼š

1. **é¡¹ç›®è¡¨** - é¡¹ç›®åŸºæœ¬ä¿¡æ¯ã€é‡‘é¢ã€æˆæœ¬ã€è¿›åº¦
2. **Bug è¡¨** - Bug è®°å½•ã€ä¸¥é‡ç¨‹åº¦ã€çŠ¶æ€
3. **å·¥å•è¡¨** - ç»´æŠ¤å·¥å•ã€ç±»å‹ã€ä¼˜å…ˆçº§
4. **æˆå‘˜è¡¨** - å›¢é˜Ÿæˆå‘˜ã€å·¥ä½œå¤©æ•°ã€æ•ˆç‡
5. **çŸ¥è¯†åº“è¡¨** - æ–‡æ¡£ã€ç±»å‹ã€çŠ¶æ€

è¯¦ç»†å­—æ®µç»“æ„è§ `backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md`

---

## ğŸ”§ é…ç½®è¯´æ˜

### å¿…éœ€é…ç½®

```env
# é£ä¹¦åº”ç”¨
FEISHU_APP_ID=cli_xxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxx

# è‡³å°‘é…ç½®ä¸€ä¸ªè¡¨æ ¼
FEISHU_PROJECT_APP_TOKEN=bascnABC123xyz
FEISHU_PROJECT_TABLE_ID=tblXYZ789abc
```

### å¯é€‰é…ç½®

```env
# Redisï¼ˆå¦‚æœä¸é…ç½®ä¼šä½¿ç”¨å†…å­˜ç¼“å­˜ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379

# CORSï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®ï¼‰
CORS_ORIGIN=https://outbook.com

# DeepSeek APIï¼ˆAI åŠŸèƒ½ï¼‰
DEEPSEEK_API_KEY=your_api_key
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **Redis ç¼“å­˜** - å‡å°‘é£ä¹¦ API è°ƒç”¨
2. **åˆ†é¡µåŠ è½½** - å¤§æ•°æ®é‡åˆ†æ‰¹è·å–
3. **Gzip å‹ç¼©** - å‡å°‘ä¼ è¾“å¤§å°
4. **é™æ€èµ„æºç¼“å­˜** - æµè§ˆå™¨ç¼“å­˜
5. **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨é‡å¯æ•…éšœæœåŠ¡

---

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker
docker-compose logs -f backend

# PM2
pm2 logs outbook-backend
```

### æµ‹è¯•é£ä¹¦è¿æ¥

```bash
cd backend
npm run test:feishu
```

### å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3000/health
```

---

## ğŸ“ å¸¸è§é—®é¢˜

è¯¦è§å„æ–‡æ¡£çš„ã€Œå¸¸è§é—®é¢˜ã€ç« èŠ‚ï¼š

- é£ä¹¦é…ç½®é—®é¢˜ â†’ `backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md`
- å‰åç«¯è”è°ƒé—®é¢˜ â†’ `docs/å‰åç«¯å¯¹æ¥æŒ‡å—.md`
- éƒ¨ç½²é—®é¢˜ â†’ `docs/å®Œæ•´éƒ¨ç½²æŒ‡å—.md`

---

## ğŸ‰ æ€»ç»“

âœ… **åç«¯å¼€å‘** - å®Œæˆ
âœ… **é£ä¹¦å¯¹æ¥** - å®Œæˆ
âœ… **å‰ç«¯å¯¹æ¥** - å®Œæˆ
âœ… **éƒ¨ç½²é…ç½®** - å®Œæˆ
âœ… **æ–‡æ¡£ç¼–å†™** - å®Œæˆ

ç³»ç»Ÿç°åœ¨å·²ç»å¯ä»¥ï¼š
- ä»é£ä¹¦å¤šç»´è¡¨æ ¼è·å–çœŸå®æ•°æ®
- æä¾›å®Œæ•´çš„ RESTful API
- æ”¯æŒæœ¬åœ°å¼€å‘å’Œç”Ÿäº§éƒ¨ç½²
- å…·å¤‡ç¼“å­˜ã€æ—¥å¿—ã€ç›‘æ§ç­‰ä¼ä¸šçº§åŠŸèƒ½

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**
1. é…ç½®é£ä¹¦åº”ç”¨å’Œè¡¨æ ¼
2. æœ¬åœ°æµ‹è¯•å‰åç«¯è”è°ƒ
3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
4. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å’Œä¼˜åŒ–

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš€

