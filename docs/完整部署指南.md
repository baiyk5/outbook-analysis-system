# OutBook å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚  å‰ç«¯åº”ç”¨       â”‚ â”€â”€â”€> â”‚  åç«¯ API æœåŠ¡  â”‚ â”€â”€â”€> â”‚  é£ä¹¦å¤šç»´è¡¨æ ¼   â”‚
â”‚  (UmiJS+React)  â”‚      â”‚  (Node.js)      â”‚      â”‚  (æ•°æ®æº)       â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚  localhost:8000 â”‚      â”‚  localhost:3000 â”‚      â”‚  é£ä¹¦å¼€æ”¾å¹³å°   â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæœ¬åœ°å¼€å‘ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡é£ä¹¦æ•°æ®

1. **åˆ›å»ºé£ä¹¦åº”ç”¨**
   - è®¿é—® https://open.feishu.cn/
   - åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
   - è·å– App ID å’Œ App Secret
   - ç”³è¯·æƒé™ï¼š`bitable:app`ã€`bitable:app:readonly`

2. **å‡†å¤‡é£ä¹¦å¤šç»´è¡¨æ ¼**
   - åˆ›å»ºå¤šç»´è¡¨æ ¼ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰çš„ï¼‰
   - æŒ‰ç…§ `backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md` ä¸­çš„ç»“æ„åˆ›å»ºè¡¨æ ¼
   - æ·»åŠ åº”ç”¨ä¸ºåä½œè€…

### ç¬¬äºŒæ­¥ï¼šé…ç½®å¹¶å¯åŠ¨åç«¯

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®é£ä¹¦ï¼ˆäº¤äº’å¼å‘å¯¼ï¼‰
npm run setup

# 4. æµ‹è¯•é£ä¹¦è¿æ¥
npm run test:feishu

# 5. å¯åŠ¨åç«¯æœåŠ¡
npm run dev
```

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®å¹¶å¯åŠ¨å‰ç«¯

```bash
# 1. å›åˆ°é¡¹ç›®æ ¹ç›®å½•
cd ..

# 2. ç¡®è®¤ .env.development é…ç½®
cat .env.development
# åº”è¯¥çœ‹åˆ°:
# USE_LOCAL_MOCK=false
# API_URL=http://localhost:3000

# 3. å¯åŠ¨å‰ç«¯æœåŠ¡
npm run dev
```

å‰ç«¯æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ã€‚

### ç¬¬å››æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿ

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8000`ï¼š

- âœ… ç™»å½•ç³»ç»Ÿ
- âœ… æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨ï¼ˆæ•°æ®æ¥è‡ªé£ä¹¦ï¼‰
- âœ… æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
- âœ… ç”ŸæˆæŠ¥å‘Š
- âœ… æµè§ˆçŸ¥è¯†åº“

---

## ğŸ“¦ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æ–¹æ¡ˆ 1: Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. åˆ›å»º Docker é…ç½®

**åç«¯ Dockerfile** (`backend/Dockerfile`):

```dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ package.json
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install --production

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»º
RUN npm run build

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨
CMD ["npm", "start"]
```

**å‰ç«¯ Dockerfile** (`Dockerfile`):

```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶ package.json
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»º
RUN npm run build

# ä½¿ç”¨ Nginx æä¾›é™æ€æ–‡ä»¶
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

**Nginx é…ç½®** (`nginx.conf`):

```nginx
server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://backend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

**Docker Compose** (`docker-compose.yml`):

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    container_name: outbook-backend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
    env_file:
      - ./backend/.env
    restart: unless-stopped

  frontend:
    build: .
    container_name: outbook-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

  redis:
    image: redis:alpine
    container_name: outbook-redis
    ports:
      - "6379:6379"
    restart: unless-stopped
```

#### 2. éƒ¨ç½²æ­¥éª¤

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
nano backend/.env  # å¡«å…¥é£ä¹¦é…ç½®

# 2. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 4. è®¿é—®ç³»ç»Ÿ
# http://your-server-ip
```

### æ–¹æ¡ˆ 2: PM2 éƒ¨ç½²

#### 1. åç«¯éƒ¨ç½²

```bash
cd backend

# å®‰è£… PM2
npm install -g pm2

# æ„å»º
npm run build

# å¯åŠ¨
pm2 start dist/app.js --name outbook-backend

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

#### 2. å‰ç«¯éƒ¨ç½²

```bash
# æ„å»º
npm run build

# ä½¿ç”¨ Nginx æˆ–å…¶ä»– Web æœåŠ¡å™¨æä¾›é™æ€æ–‡ä»¶
# å°† dist ç›®å½•å¤åˆ¶åˆ° Nginx çš„ html ç›®å½•
sudo cp -r dist/* /usr/share/nginx/html/
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### åç«¯ç¯å¢ƒå˜é‡ (`backend/.env`)

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# é£ä¹¦åº”ç”¨é…ç½®
FEISHU_APP_ID=cli_xxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxx

# é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®
FEISHU_PROJECT_APP_TOKEN=bascnABC123xyz
FEISHU_PROJECT_TABLE_ID=tblXYZ789abc

FEISHU_BUG_APP_TOKEN=bascnDEF456uvw
FEISHU_BUG_TABLE_ID=tblUVW123def

FEISHU_TICKET_APP_TOKEN=bascnGHI789rst
FEISHU_TICKET_TABLE_ID=tblRST456ghi

FEISHU_MEMBER_APP_TOKEN=bascnJKL012mno
FEISHU_MEMBER_TABLE_ID=tblMNO789jkl

FEISHU_KNOWLEDGE_APP_TOKEN=bascnPQR345stu
FEISHU_KNOWLEDGE_TABLE_ID=tblSTU012pqr

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ç¼“å­˜é…ç½®ï¼ˆç§’ï¼‰
CACHE_TTL_SHORT=300
CACHE_TTL_MEDIUM=1800
CACHE_TTL_LONG=3600

# CORS é…ç½®
CORS_ORIGIN=https://outbook.com

# DeepSeek API é…ç½®
DEEPSEEK_API_KEY=your_api_key
DEEPSEEK_API_URL=https://api.deepseek.com
```

### å‰ç«¯ç¯å¢ƒå˜é‡ (`.env.production`)

```env
# ç”Ÿäº§ç¯å¢ƒä¸ä½¿ç”¨æœ¬åœ° Mock æ•°æ®
USE_LOCAL_MOCK=false

# åç«¯ API åœ°å€ï¼ˆå¦‚æœä½¿ç”¨ Nginx ä»£ç†åˆ™ç•™ç©ºï¼‰
API_URL=
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨ Redis ç¼“å­˜

```bash
# å®‰è£… Redis
sudo apt-get install redis-server

# å¯åŠ¨ Redis
sudo systemctl start redis
sudo systemctl enable redis
```

### 2. é…ç½® Nginx ç¼“å­˜

```nginx
# åœ¨ nginx.conf ä¸­æ·»åŠ 
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=60m;

location /api/ {
    proxy_cache api_cache;
    proxy_cache_valid 200 5m;
    proxy_cache_key "$scheme$request_method$host$request_uri";
    
    proxy_pass http://backend:3000;
}
```

### 3. å¯ç”¨ Gzip å‹ç¼©

å·²åœ¨ Nginx é…ç½®ä¸­å¯ç”¨ã€‚

---

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### 1. PM2 ç›‘æ§

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs outbook-backend

# ç›‘æ§é¢æ¿
pm2 monit
```

### 2. Docker æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨

1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :3000`
2. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®
3. æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs` æˆ– `docker-compose logs backend`

### å‰ç«¯æ— æ³•è®¿é—®åç«¯

1. æ£€æŸ¥ CORS é…ç½®
2. æ£€æŸ¥ Nginx ä»£ç†é…ç½®
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### é£ä¹¦ API é”™è¯¯

1. è¿è¡Œ `npm run test:feishu` æµ‹è¯•è¿æ¥
2. æ£€æŸ¥åº”ç”¨æƒé™
3. æ£€æŸ¥è¡¨æ ¼æ˜¯å¦æ·»åŠ åº”ç”¨ä¸ºåä½œè€…

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹ï¼š

- [é£ä¹¦å¯¹æ¥æŒ‡å—](../backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md)
- [å¿«é€Ÿå¼€å§‹](../backend/docs/å¿«é€Ÿå¼€å§‹.md)
- [å‰åç«¯å¯¹æ¥æŒ‡å—](./å‰åç«¯å¯¹æ¥æŒ‡å—.md)
- [é£ä¹¦å¼€æ”¾å¹³å°æ–‡æ¡£](https://open.feishu.cn/)

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„ OutBook ç³»ç»Ÿå·²ç»å®Œæ•´éƒ¨ç½²å¹¶è¿è¡Œäº†ï¼

äº«å—ä½¿ç”¨å§ï¼ ğŸš€

