# å‰åç«¯å¯¹æ¥æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

OutBook ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š

```
å‰ç«¯ (UmiJS + React)          åç«¯ (Node.js + Express)          é£ä¹¦å¤šç»´è¡¨æ ¼
    â†“                              â†“                              â†“
http://localhost:8000  â†’  http://localhost:3000  â†’  é£ä¹¦å¼€æ”¾å¹³å° API
```

## ğŸ”§ åç«¯é…ç½®

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®é£ä¹¦ï¼ˆäº¤äº’å¼å‘å¯¼ï¼‰
npm run setup

# æµ‹è¯•é£ä¹¦è¿æ¥
npm run test:feishu

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### 2. éªŒè¯åç«¯æœåŠ¡

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- å¥åº·æ£€æŸ¥: http://localhost:3000/health
- é¡¹ç›®åˆ—è¡¨: http://localhost:3000/api/projects
- ç»Ÿè®¡æ¦‚è§ˆ: http://localhost:3000/api/statistics/overview

å¦‚æœèƒ½çœ‹åˆ°æ•°æ®ï¼Œè¯´æ˜åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

---

## ğŸ¨ å‰ç«¯é…ç½®

### æ–¹å¼ 1: ä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆæ¨èï¼‰

#### 1. ä¿®æ”¹ `.env.development`

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
nano .env.development
```

ä¿®æ”¹ä¸ºï¼š

```env
# å…³é—­æœ¬åœ° Mock æ•°æ®
USE_LOCAL_MOCK=false

# é…ç½®åç«¯ API åœ°å€
API_URL=http://localhost:3000
```

#### 2. ä¿®æ”¹ UmiJS ä»£ç†é…ç½®

ç¼–è¾‘ `config/config.ts`ï¼Œç¡®ä¿æœ‰ä»£ç†é…ç½®ï¼š

```typescript
export default defineConfig({
  // ... å…¶ä»–é…ç½®
  
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
    },
  },
  
  // ... å…¶ä»–é…ç½®
});
```

#### 3. é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### æ–¹å¼ 2: ç›´æ¥ä¿®æ”¹è¯·æ±‚é…ç½®

å¦‚æœä¸æƒ³ä½¿ç”¨ä»£ç†ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹è¯·æ±‚åŸºç¡€ URLã€‚

ç¼–è¾‘ `src/services/request.ts`ï¼ˆå¦‚æœæœ‰ï¼‰æˆ– `src/app.tsx`ï¼š

```typescript
export const request = {
  baseURL: process.env.USE_LOCAL_MOCK === 'true' 
    ? '' 
    : 'http://localhost:3000',
  // ... å…¶ä»–é…ç½®
};
```

---

## ğŸ§ª æµ‹è¯•å‰åç«¯è”è°ƒ

### 1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ

```bash
cd backend
npm run dev
```

åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸš€ OutBook åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ!
ğŸ“¡ æœåŠ¡åœ°å€: http://localhost:3000
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
npm run dev
```

### 3. æµ‹è¯•åŠŸèƒ½

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8000`ï¼Œæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… ç™»å½•åŠŸèƒ½
- âœ… é¡¹ç›®åˆ—è¡¨æ˜¾ç¤º
- âœ… æ•°æ®ç»Ÿè®¡å›¾è¡¨
- âœ… æŠ¥å‘Šç”Ÿæˆ
- âœ… çŸ¥è¯†åº“æ–‡æ¡£
- âœ… å·¥ä½œå°æ•°æ®

### 4. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ¢åˆ° Network æ ‡ç­¾ï¼š

- æ£€æŸ¥è¯·æ±‚æ˜¯å¦å‘é€åˆ° `http://localhost:3000/api/...`
- æ£€æŸ¥å“åº”çŠ¶æ€ç æ˜¯å¦ä¸º 200
- æ£€æŸ¥å“åº”æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å‰ç«¯è¯·æ±‚åç«¯æ—¶å‡ºç° CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Access to XMLHttpRequest at 'http://localhost:3000/api/projects' 
from origin 'http://localhost:8000' has been blocked by CORS policy
```

**è§£å†³æ–¹æ³•**:

æ£€æŸ¥åç«¯ `.env` æ–‡ä»¶ä¸­çš„ CORS é…ç½®ï¼š

```env
CORS_ORIGIN=http://localhost:8000
```

ç¡®ä¿ä¸å‰ç«¯åœ°å€ä¸€è‡´ã€‚

### Q2: è¯·æ±‚è¿”å› 404

**åŸå› **: è·¯ç”±é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥å‰ç«¯è¯·æ±‚çš„ URL æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥åç«¯è·¯ç”±æ˜¯å¦å®šä¹‰
3. æŸ¥çœ‹åç«¯æ§åˆ¶å°æ—¥å¿—

### Q3: æ•°æ®æ ¼å¼ä¸åŒ¹é…

**åŸå› **: åç«¯è¿”å›çš„æ•°æ®æ ¼å¼ä¸å‰ç«¯æœŸæœ›çš„ä¸ä¸€è‡´

**è§£å†³æ–¹æ³•**:

1. æŸ¥çœ‹åç«¯ `src/utils/transform.ts` ä¸­çš„æ•°æ®è½¬æ¢é€»è¾‘
2. å¯¹æ¯”å‰ç«¯ Mock æ•°æ®çš„æ ¼å¼
3. è°ƒæ•´è½¬æ¢å‡½æ•°ä½¿å…¶åŒ¹é…

### Q4: é£ä¹¦å­—æ®µåä¸åŒ¹é…

**åŸå› **: é£ä¹¦è¡¨æ ¼çš„å­—æ®µåä¸ä»£ç ä¸­çš„ä¸ä¸€è‡´

**è§£å†³æ–¹æ³•**:

**æ–¹æ³• 1**: ä¿®æ”¹é£ä¹¦è¡¨æ ¼å­—æ®µåï¼ˆæ¨èï¼‰

æŒ‰ç…§ `backend/docs/é£ä¹¦å¯¹æ¥æŒ‡å—.md` ä¸­çš„å»ºè®®ä¿®æ”¹ã€‚

**æ–¹æ³• 2**: ä¿®æ”¹ä»£ç ä¸­çš„å­—æ®µæ˜ å°„

ç¼–è¾‘ `backend/src/utils/transform.ts`ï¼š

```typescript
export function transformProject(record: any) {
  const fields = record.fields;
  return {
    id: record.record_id,
    name: getStringField(fields, 'ä½ çš„å®é™…å­—æ®µå'), // ä¿®æ”¹è¿™é‡Œ
    school: getStringField(fields, 'ä½ çš„å®é™…å­—æ®µå'),
    // ...
  };
}
```

---

## ğŸ“Š æ•°æ®æµç¨‹

### 1. å‰ç«¯å‘èµ·è¯·æ±‚

```typescript
// src/services/projects.ts
export async function getProjects(options?: { [key: string]: any }) {
  if (shouldUseMockData()) {
    return mockResponse(mockProjectsData);
  }
  return request('/api/projects', {
    method: 'GET',
    ...(options || {}),
  });
}
```

### 2. è¯·æ±‚é€šè¿‡ä»£ç†è½¬å‘åˆ°åç«¯

```
http://localhost:8000/api/projects
    â†“ (UmiJS ä»£ç†)
http://localhost:3000/api/projects
```

### 3. åç«¯å¤„ç†è¯·æ±‚

```typescript
// backend/src/routes/index.ts
router.get('/api/projects', asyncHandler(controllers.getProjects));

// backend/src/controllers/index.ts
export const getProjects = asyncHandler(async (req, res) => {
  const projects = await projectService.getProjects();
  res.json(successResponse(projects));
});

// backend/src/services/project.service.ts
export async function getProjects() {
  // 1. æ£€æŸ¥ç¼“å­˜
  // 2. ä»é£ä¹¦è·å–æ•°æ®
  // 3. è½¬æ¢æ•°æ®æ ¼å¼
  // 4. è¿”å›ç»“æœ
}
```

### 4. åç«¯ä»é£ä¹¦è·å–æ•°æ®

```typescript
// backend/src/services/feishu.ts
const records = await getTableRecords(appToken, tableId);
```

### 5. æ•°æ®è½¬æ¢

```typescript
// backend/src/utils/transform.ts
const projects = records.map(transformProject);
```

### 6. è¿”å›ç»™å‰ç«¯

```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "name": "æ¸…åå¤§å­¦æ™ºæ…§æ ¡å›­ç³»ç»Ÿ",
      "school": "æ¸…åå¤§å­¦",
      ...
    }
  ],
  "errorMessage": null
}
```

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å‰ç«¯é…ç½®

ç¼–è¾‘ `.env.production`ï¼š

```env
USE_LOCAL_MOCK=false
API_URL=https://api.outbook.com
```

### åç«¯é…ç½®

ç¼–è¾‘ `backend/.env`ï¼š

```env
NODE_ENV=production
PORT=3000
CORS_ORIGIN=https://outbook.com
```

### æ„å»ºå’Œéƒ¨ç½²

```bash
# å‰ç«¯
npm run build

# åç«¯
cd backend
npm run build
npm start
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹è”è°ƒå‰ï¼Œç¡®ä¿ï¼š

- [ ] åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼ˆhttp://localhost:3000ï¼‰
- [ ] é£ä¹¦é…ç½®æ­£ç¡®ï¼ˆè¿è¡Œ `npm run test:feishu`ï¼‰
- [ ] å‰ç«¯ `.env.development` é…ç½®æ­£ç¡®
- [ ] UmiJS ä»£ç†é…ç½®æ­£ç¡®
- [ ] CORS é…ç½®æ­£ç¡®
- [ ] é£ä¹¦è¡¨æ ¼æœ‰æ•°æ®
- [ ] é£ä¹¦å­—æ®µåä¸ä»£ç åŒ¹é…

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„å‰åç«¯åº”è¯¥å¯ä»¥æ­£å¸¸é€šä¿¡äº†ï¼

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- åç«¯æ§åˆ¶å°æ—¥å¿—
- å‰ç«¯æµè§ˆå™¨æ§åˆ¶å°
- ç½‘ç»œè¯·æ±‚è¯¦æƒ…

éœ€è¦å¸®åŠ©è¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

