{"version":3,"sources":["src/pages/reports/index.tsx"],"sourcesContent":["import { PageContainer, ProCard } from '@ant-design/pro-components';\nimport { Button, Card, DatePicker, Form, List, Space, Tag, message, Modal, Spin, Select } from 'antd';\nimport { FileTextOutlined, DownloadOutlined, RobotOutlined, CalendarOutlined } from '@ant-design/icons';\nimport { useEffect, useState } from 'react';\nimport { request } from '@umijs/max';\nimport moment from 'moment';\n\nconst { RangePicker } = DatePicker;\n\ninterface ReportType {\n  id: string;\n  title: string;\n  type: 'monthly' | 'quarterly';\n  period: string;\n  generatedAt: string;\n  summary: string;\n}\n\nconst Reports: React.FC = () => {\n  const [aiModalVisible, setAiModalVisible] = useState(false);\n  const [aiGenerating, setAiGenerating] = useState(false);\n  const [form] = Form.useForm();\n\n  // 内联 Mock 数据\n  const monthlyReports: ReportType[] = [\n    {\n      id: '1',\n      title: '2024年6月项目月报',\n      type: 'monthly',\n      period: '2024-06',\n      generatedAt: '2024-07-01 10:30:00',\n      summary: '本月完成3个项目，总成交金额746万元，利润298.4万元。项目整体进度良好，BUG修复率达95%。',\n    },\n    {\n      id: '2',\n      title: '2024年5月项目月报',\n      type: 'monthly',\n      period: '2024-05',\n      generatedAt: '2024-06-01 10:30:00',\n      summary: '本月完成2个项目，总成交金额678万元，利润271.2万元。新增项目2个，团队协作效率提升15%。',\n    },\n    {\n      id: '3',\n      title: '2024年4月项目月报',\n      type: 'monthly',\n      period: '2024-04',\n      generatedAt: '2024-05-01 10:30:00',\n      summary: '本月完成4个项目，总成交金额593万元，利润237.2万元。客户满意度达98%，获得多个好评。',\n    },\n    {\n      id: '4',\n      title: '2024年3月项目月报',\n      type: 'monthly',\n      period: '2024-03',\n      generatedAt: '2024-04-01 10:30:00',\n      summary: '本月完成3个项目，总成交金额458万元，利润183.2万元。技术难点攻克2个，团队能力提升显著。',\n    },\n  ];\n\n  const quarterlyReports: ReportType[] = [\n    {\n      id: 'q1',\n      title: '2024年第二季度项目报告',\n      type: 'quarterly',\n      period: '2024-Q2',\n      generatedAt: '2024-07-05 14:00:00',\n      summary: '第二季度完成项目12个，总成交金额1977万元，利润806.8万元。团队规模扩大20%，项目交付质量稳步提升。',\n    },\n    {\n      id: 'q2',\n      title: '2024年第一季度项目报告',\n      type: 'quarterly',\n      period: '2024-Q1',\n      generatedAt: '2024-04-05 14:00:00',\n      summary: '第一季度完成项目8个，总成交金额1230万元，利润492万元。成功开拓3所新高校客户，市场占有率提升10%。',\n    },\n  ];\n\n  const fetchReports = async () => {\n    // 使用内联数据，不需要请求\n  };\n\n  const handleGenerateReport = async (values: any) => {\n    try {\n      const response = await request('/api/reports/generate', {\n        method: 'POST',\n        data: values,\n      });\n      \n      if (response.success) {\n        message.success('报告生成成功！');\n        fetchReports();\n      }\n    } catch (error) {\n      message.error('报告生成失败！');\n    }\n  };\n\n  const handleAIGenerate = async (values: any) => {\n    setAiGenerating(true);\n    try {\n      // 这里预留 AI 接口调用\n      await new Promise(resolve => setTimeout(resolve, 2000));\n      message.success('AI 报告生成成功！（演示功能）');\n      setAiModalVisible(false);\n      fetchReports();\n    } catch (error) {\n      message.error('AI 报告生成失败！');\n    } finally {\n      setAiGenerating(false);\n    }\n  };\n\n  const handleDownload = (report: ReportType) => {\n    message.info(`下载报告: ${report.title}`);\n    // 这里实现下载逻辑\n  };\n\n  return (\n    <PageContainer\n      title=\"报告生成\"\n      subTitle=\"生成月度和季度分析报告\"\n      extra={[\n        <Button\n          key=\"ai\"\n          type=\"primary\"\n          icon={<RobotOutlined />}\n          onClick={() => setAiModalVisible(true)}\n        >\n          AI 智能生成\n        </Button>,\n      ]}\n    >\n      <ProCard split=\"vertical\">\n        <ProCard title=\"月度报告\" colSpan=\"50%\">\n          <Form\n            form={form}\n            layout=\"inline\"\n            onFinish={handleGenerateReport}\n            style={{ marginBottom: 16 }}\n          >\n            <Form.Item name=\"month\" label=\"选择月份\">\n              <DatePicker picker=\"month\" />\n            </Form.Item>\n            <Form.Item>\n              <Button type=\"primary\" htmlType=\"submit\">\n                生成月度报告\n              </Button>\n            </Form.Item>\n          </Form>\n\n          <List\n            dataSource={monthlyReports}\n            renderItem={(item) => (\n              <List.Item\n                actions={[\n                  <Button\n                    key=\"download\"\n                    type=\"link\"\n                    icon={<DownloadOutlined />}\n                    onClick={() => handleDownload(item)}\n                  >\n                    下载\n                  </Button>,\n                ]}\n              >\n                <List.Item.Meta\n                  avatar={<FileTextOutlined style={{ fontSize: 24, color: '#1890ff' }} />}\n                  title={\n                    <Space>\n                      {item.title}\n                      <Tag color=\"blue\">月度</Tag>\n                    </Space>\n                  }\n                  description={\n                    <div>\n                      <p>{item.summary}</p>\n                      <p style={{ color: '#999', fontSize: 12 }}>\n                        <CalendarOutlined /> 生成时间: {item.generatedAt}\n                      </p>\n                    </div>\n                  }\n                />\n              </List.Item>\n            )}\n          />\n        </ProCard>\n\n        <ProCard title=\"季度报告\" colSpan=\"50%\">\n          <Form\n            layout=\"inline\"\n            onFinish={handleGenerateReport}\n            style={{ marginBottom: 16 }}\n          >\n            <Form.Item name=\"quarter\" label=\"选择季度\">\n              <DatePicker picker=\"quarter\" />\n            </Form.Item>\n            <Form.Item>\n              <Button type=\"primary\" htmlType=\"submit\">\n                生成季度报告\n              </Button>\n            </Form.Item>\n          </Form>\n\n          <List\n            dataSource={quarterlyReports}\n            renderItem={(item) => (\n              <List.Item\n                actions={[\n                  <Button\n                    key=\"download\"\n                    type=\"link\"\n                    icon={<DownloadOutlined />}\n                    onClick={() => handleDownload(item)}\n                  >\n                    下载\n                  </Button>,\n                ]}\n              >\n                <List.Item.Meta\n                  avatar={<FileTextOutlined style={{ fontSize: 24, color: '#52c41a' }} />}\n                  title={\n                    <Space>\n                      {item.title}\n                      <Tag color=\"green\">季度</Tag>\n                    </Space>\n                  }\n                  description={\n                    <div>\n                      <p>{item.summary}</p>\n                      <p style={{ color: '#999', fontSize: 12 }}>\n                        <CalendarOutlined /> 生成时间: {item.generatedAt}\n                      </p>\n                    </div>\n                  }\n                />\n              </List.Item>\n            )}\n          />\n        </ProCard>\n      </ProCard>\n\n      {/* AI 生成报告弹窗 */}\n      <Modal\n        title={\n          <Space>\n            <RobotOutlined style={{ color: '#1890ff' }} />\n            AI 智能生成报告\n          </Space>\n        }\n        open={aiModalVisible}\n        onCancel={() => setAiModalVisible(false)}\n        footer={null}\n      >\n        <Spin spinning={aiGenerating} tip=\"AI 正在分析数据并生成报告...\">\n          <Form\n            layout=\"vertical\"\n            onFinish={handleAIGenerate}\n          >\n            <Form.Item\n              name=\"dateRange\"\n              label=\"选择时间范围\"\n              rules={[{ required: true, message: '请选择时间范围' }]}\n            >\n              <RangePicker style={{ width: '100%' }} />\n            </Form.Item>\n            <Form.Item\n              name=\"reportType\"\n              label=\"报告类型\"\n              rules={[{ required: true, message: '请选择报告类型' }]}\n            >\n              <Select\n                style={{ width: '100%' }}\n                placeholder=\"请选择报告类型\"\n                options={[\n                  { label: '月度报告', value: 'monthly' },\n                  { label: '季度报告', value: 'quarterly' },\n                  { label: '年度报告', value: 'yearly' },\n                ]}\n              />\n            </Form.Item>\n            <Form.Item>\n              <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\n                <Button onClick={() => setAiModalVisible(false)}>\n                  取消\n                </Button>\n                <Button type=\"primary\" htmlType=\"submit\" icon={<RobotOutlined />}>\n                  AI 生成\n                </Button>\n              </Space>\n            </Form.Item>\n          </Form>\n          <Card size=\"small\" style={{ marginTop: 16, background: '#f0f2f5' }}>\n            <p style={{ margin: 0, color: '#666' }}>\n              💡 提示：AI 将根据选定时间范围内的项目数据，自动分析并生成包含关键指标、趋势分析和建议的智能报告。\n            </p>\n          </Card>\n        </Spin>\n      </Modal>\n    </PageContainer>\n  );\n};\n\nexport default Reports;\n\n"],"names":[],"mappings":"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"}