# OutBook 后端快速开始指南

## 🚀 5 分钟快速上手

### 步骤 1: 安装依赖

```bash
cd backend
npm install
```

### 步骤 2: 配置飞书（使用交互式向导）

```bash
npm run setup
```

这个命令会启动一个交互式向导，引导你完成飞书配置。

**你需要准备：**
- 飞书应用的 App ID 和 App Secret
- 飞书多维表格的 URL（从浏览器地址栏复制）

**向导会帮你：**
- 自动提取 app_token 和 table_id
- 生成 .env 配置文件
- 验证配置是否正确

### 步骤 3: 测试飞书连接

```bash
npm run test:feishu
```

这个命令会测试：
- ✅ 飞书应用凭证是否正确
- ✅ 是否有权限访问表格
- ✅ 表格数据是否能正常获取
- ✅ 显示表格字段名称

### 步骤 4: 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://localhost:3000` 启动。

### 步骤 5: 测试 API

打开浏览器或使用 curl 测试：

```bash
# 健康检查
curl http://localhost:3000/health

# 获取项目列表
curl http://localhost:3000/api/projects

# 获取统计概览
curl http://localhost:3000/api/statistics/overview
```

---

## 📋 手动配置（如果不使用向导）

### 1. 创建 .env 文件

```bash
cp .env.example .env
```

### 2. 编辑 .env 文件

```env
# 飞书应用配置
FEISHU_APP_ID=cli_xxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxx

# 项目表配置
FEISHU_PROJECT_APP_TOKEN=bascnABC123xyz
FEISHU_PROJECT_TABLE_ID=tblXYZ789abc
```

### 3. 如何获取 app_token 和 table_id？

**方法 1: 从 URL 提取**

打开你的飞书多维表格，查看浏览器地址栏：

```
https://example.feishu.cn/base/bascnABC123xyz?table=tblXYZ789abc&view=vewDEF456
                              ↑                      ↑
                          app_token              table_id
```

**方法 2: 使用飞书开放平台 API Explorer**

访问 https://open.feishu.cn/api-explorer/

---

## 🔧 常见问题

### Q: 提示 "99991663" 错误

**原因**: 应用没有权限访问表格

**解决方法**:

1. 打开飞书多维表格
2. 点击右上角「分享」→「添加协作者」
3. 搜索你的应用名称并添加
4. 或者在飞书开放平台重新申请权限

### Q: 提示 "app_token 无效"

**原因**: app_token 提取错误

**解决方法**:

1. 重新打开飞书多维表格
2. 确保 URL 中包含 `/base/` 部分
3. 复制 `/base/` 后面的字符串（以 `basc` 开头）

### Q: 获取的数据为空

**原因**: 表格中没有数据，或字段名不匹配

**解决方法**:

1. 检查表格中是否有数据
2. 运行 `npm run test:feishu` 查看字段名
3. 对比代码中的字段名是否一致

### Q: 字段名不匹配怎么办？

**方法 1: 修改飞书表格字段名**（推荐）

按照文档中的建议字段名修改飞书表格。

**方法 2: 修改代码中的字段映射**

编辑 `src/utils/transform.ts`，修改字段名映射：

```typescript
export function transformProject(record: any) {
  const fields = record.fields;
  return {
    id: record.record_id,
    name: getStringField(fields, '你的字段名'), // 修改这里
    // ...
  };
}
```

---

## 📊 推荐的飞书表格结构

详见 [飞书对接指南.md](./飞书对接指南.md)

---

## 🎯 下一步

配置完成后，你可以：

1. **前端对接**: 修改前端 `.env` 文件，指向后端 API
2. **部署**: 使用 Docker 或 PM2 部署到服务器
3. **扩展**: 添加更多 API 接口和功能

---

## 📞 需要帮助？

如果遇到问题：

1. 运行 `npm run test:feishu` 查看详细错误信息
2. 查看 [飞书对接指南.md](./飞书对接指南.md)
3. 查看飞书开放平台文档: https://open.feishu.cn/

---

## 🎉 完成！

现在你的后端服务已经可以从飞书获取数据了！

下一步可以启动前端项目，实现前后端联调。

