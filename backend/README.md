# OutBook åç«¯æœåŠ¡

OutBook é¡¹ç›®ç®¡ç†ç³»ç»Ÿçš„åç«¯æœåŠ¡ï¼ŒåŸºäº Node.js + TypeScript + Express å¼€å‘ï¼Œå¯¹æ¥é£ä¹¦å¼€æ”¾å¹³å°è·å–å¤šç»´è¡¨æ ¼æ•°æ®ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… å¯¹æ¥é£ä¹¦å¤šç»´è¡¨æ ¼ API
- âœ… RESTful API è®¾è®¡
- âœ… Redis ç¼“å­˜æ”¯æŒ
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… æ•°æ®è½¬æ¢å’Œèšåˆ
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… CORS è·¨åŸŸæ”¯æŒ
- âœ… è¯·æ±‚æ—¥å¿—è®°å½•
- âœ… ä¼˜é›…å…³é—­

## ğŸ“‹ æŠ€æœ¯æ ˆ

- **Node.js** - è¿è¡Œç¯å¢ƒ
- **TypeScript** - ç±»å‹å®‰å…¨
- **Express** - Web æ¡†æ¶
- **@larksuiteoapi/node-sdk** - é£ä¹¦å®˜æ–¹ SDK
- **Redis** - ç¼“å­˜
- **dayjs** - æ—¥æœŸå¤„ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é…ç½®ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# é£ä¹¦åº”ç”¨é…ç½®
FEISHU_APP_ID=your_app_id_here
FEISHU_APP_SECRET=your_app_secret_here

# é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®
FEISHU_PROJECT_APP_TOKEN=your_project_app_token
FEISHU_PROJECT_TABLE_ID=your_project_table_id

# ... å…¶ä»–é…ç½®
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### 4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
npm start
```

## ğŸ“š API æ–‡æ¡£

### ç”¨æˆ·ç›¸å…³

- `POST /api/login/account` - ç™»å½•
- `GET /api/currentUser` - è·å–å½“å‰ç”¨æˆ·
- `POST /api/login/outLogin` - ç™»å‡º
- `GET /api/notices` - è·å–é€šçŸ¥

### é¡¹ç›®ç›¸å…³

- `GET /api/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `GET /api/projects/:id` - è·å–å•ä¸ªé¡¹ç›®

### ç»Ÿè®¡ç›¸å…³

- `GET /api/statistics/overview` - ç»Ÿè®¡æ¦‚è§ˆ
- `GET /api/statistics/trend` - è¶‹åŠ¿æ•°æ®
- `GET /api/statistics/wordcloud` - å­¦æ ¡è¯äº‘
- `GET /api/statistics/bug-analysis` - Bug åˆ†æ
- `GET /api/statistics/ticket-analysis` - å·¥å•åˆ†æ
- `GET /api/statistics/financial` - è´¢åŠ¡æ•°æ®

### æŠ¥å‘Šç›¸å…³

- `GET /api/reports/monthly` - æœˆåº¦æŠ¥å‘Š
- `GET /api/reports/quarterly` - å­£åº¦æŠ¥å‘Š
- `POST /api/reports/generate` - AI ç”ŸæˆæŠ¥å‘Š

### çŸ¥è¯†åº“ç›¸å…³

- `GET /api/knowledge/documents` - æ–‡æ¡£åˆ—è¡¨
- `GET /api/knowledge/stats` - çŸ¥è¯†åº“ç»Ÿè®¡

### å·¥ä½œå°ç›¸å…³

- `GET /api/workplace/notices` - é¡¹ç›®é€šçŸ¥
- `GET /api/workplace/activities` - æ´»åŠ¨åˆ—è¡¨
- `GET /api/workplace/charts` - å›¾è¡¨æ•°æ®

### åˆ†æç›¸å…³

- `GET /api/analysis/charts` - åˆ†æå›¾è¡¨æ•°æ®

### å¥åº·æ£€æŸ¥

- `GET /health` - å¥åº·æ£€æŸ¥

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts     # ä¸»é…ç½®
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ feishu.ts    # é£ä¹¦ API å°è£…
â”‚   â”‚   â”œâ”€â”€ cache.ts     # ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ project.service.ts      # é¡¹ç›®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ statistics.service.ts   # ç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ report.service.ts       # æŠ¥å‘ŠæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ knowledge.service.ts    # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”‚   â””â”€â”€ workplace.service.ts    # å·¥ä½œå°æœåŠ¡
â”‚   â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â””â”€â”€ index.ts     # ç»Ÿä¸€æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ index.ts     # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ transform.ts # æ•°æ®è½¬æ¢
â”‚   â””â”€â”€ app.ts           # åº”ç”¨å…¥å£
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ”§ é£ä¹¦é…ç½®æŒ‡å—

### 1. åˆ›å»ºé£ä¹¦åº”ç”¨

1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
3. è·å– App ID å’Œ App Secret

### 2. ç”³è¯·æƒé™

åœ¨åº”ç”¨ç®¡ç†é¡µé¢ï¼Œç”³è¯·ä»¥ä¸‹æƒé™ï¼š

- `bitable:app` - å¤šç»´è¡¨æ ¼åº”ç”¨æƒé™
- `bitable:app:readonly` - å¤šç»´è¡¨æ ¼åªè¯»æƒé™

### 3. è·å–è¡¨æ ¼ä¿¡æ¯

1. æ‰“å¼€ä½ çš„é£ä¹¦å¤šç»´è¡¨æ ¼
2. ä» URL ä¸­è·å– `app_token` å’Œ `table_id`

URL æ ¼å¼ï¼š`https://xxx.feishu.cn/base/{app_token}?table={table_id}`

### 4. é…ç½®ç¯å¢ƒå˜é‡

å°†è·å–çš„ä¿¡æ¯å¡«å…¥ `.env` æ–‡ä»¶ã€‚

## ğŸ“Š é£ä¹¦è¡¨æ ¼ç»“æ„å»ºè®®

### é¡¹ç›®è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| é¡¹ç›®åç§° | æ–‡æœ¬ | é¡¹ç›®åç§° |
| å­¦æ ¡åç§° | æ–‡æœ¬ | å®¢æˆ·å­¦æ ¡ |
| åˆåŒé‡‘é¢ | æ•°å­— | åˆåŒé‡‘é¢ |
| å®é™…æˆæœ¬ | æ•°å­— | å®é™…æˆæœ¬ |
| åˆ©æ¶¦ | å…¬å¼ | åˆåŒé‡‘é¢ - å®é™…æˆæœ¬ |
| åˆ©æ¶¦ç‡ | å…¬å¼ | åˆ©æ¶¦ / åˆåŒé‡‘é¢ * 100 |
| çŠ¶æ€ | å•é€‰ | è¿›è¡Œä¸­/å·²å®Œæˆ/è§„åˆ’ä¸­ |
| å¼€å§‹æ—¥æœŸ | æ—¥æœŸ | é¡¹ç›®å¼€å§‹æ—¥æœŸ |
| ç»“æŸæ—¥æœŸ | æ—¥æœŸ | é¡¹ç›®ç»“æŸæ—¥æœŸ |
| é¡¹ç›®ç»ç† | äººå‘˜ | é¡¹ç›®è´Ÿè´£äºº |
| å›¢é˜Ÿæˆå‘˜ | äººå‘˜(å¤šé€‰) | å›¢é˜Ÿæˆå‘˜ |

### Bug è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| æ‰€å±é¡¹ç›® | å…³è” | å…³è”é¡¹ç›®è¡¨ |
| Bugæ ‡é¢˜ | æ–‡æœ¬ | Bug æ ‡é¢˜ |
| Bugæè¿° | æ–‡æœ¬ | Bug æè¿° |
| ä¸¥é‡ç¨‹åº¦ | å•é€‰ | é«˜/ä¸­/ä½ |
| çŠ¶æ€ | å•é€‰ | å¾…å¤„ç†/å¤„ç†ä¸­/å·²è§£å†³ |
| è´Ÿè´£äºº | äººå‘˜ | è´Ÿè´£äºº |
| åˆ›å»ºæ—¶é—´ | æ—¥æœŸ | åˆ›å»ºæ—¶é—´ |
| è§£å†³æ—¶é—´ | æ—¥æœŸ | è§£å†³æ—¶é—´ |

### å·¥å•è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| æ‰€å±é¡¹ç›® | å…³è” | å…³è”é¡¹ç›®è¡¨ |
| å·¥å•æ ‡é¢˜ | æ–‡æœ¬ | å·¥å•æ ‡é¢˜ |
| å·¥å•ç±»å‹ | å•é€‰ | ç»´æŠ¤/ä¿®å¤ |
| çŠ¶æ€ | å•é€‰ | å¾…å¤„ç†/å¤„ç†ä¸­/å·²å®Œæˆ |
| è´Ÿè´£äºº | äººå‘˜ | è´Ÿè´£äºº |
| åˆ›å»ºæ—¶é—´ | æ—¥æœŸ | åˆ›å»ºæ—¶é—´ |

## ğŸ”„ ç¼“å­˜ç­–ç•¥

- **çŸ­æœŸç¼“å­˜** (5åˆ†é’Ÿ): é¡¹ç›®åˆ—è¡¨ã€Bugåˆ—è¡¨ã€å·¥å•åˆ—è¡¨
- **ä¸­æœŸç¼“å­˜** (30åˆ†é’Ÿ): ç»Ÿè®¡æ•°æ®ã€æŠ¥å‘Šæ•°æ®
- **é•¿æœŸç¼“å­˜** (1å°æ—¶): è¯äº‘æ•°æ®ã€é…ç½®æ•°æ®

ç¼“å­˜ä½¿ç”¨ Redisï¼Œå¦‚æœ Redis ä¸å¯ç”¨ä¼šè‡ªåŠ¨é™çº§åˆ°å†…å­˜ç¼“å­˜ã€‚

## ğŸ› è°ƒè¯•

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
NODE_ENV=development npm run dev
```

## ğŸ“ å¼€å‘å»ºè®®

1. **æ•°æ®è½¬æ¢**: æ‰€æœ‰é£ä¹¦æ•°æ®éƒ½åº”è¯¥é€šè¿‡ `utils/transform.ts` è½¬æ¢
2. **ç¼“å­˜ä½¿ç”¨**: é¢‘ç¹è®¿é—®çš„æ•°æ®åº”è¯¥ä½¿ç”¨ç¼“å­˜
3. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `asyncHandler` åŒ…è£…æ‰€æœ‰å¼‚æ­¥è·¯ç”±
4. **ç±»å‹å®‰å…¨**: å……åˆ†åˆ©ç”¨ TypeScript çš„ç±»å‹ç³»ç»Ÿ

## ğŸš¢ éƒ¨ç½²

### Docker éƒ¨ç½²

åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install --production

COPY . .
RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

æ„å»ºå’Œè¿è¡Œï¼š

```bash
docker build -t outbook-backend .
docker run -p 3000:3000 --env-file .env outbook-backend
```

### PM2 éƒ¨ç½²

```bash
npm install -g pm2
npm run build
pm2 start dist/app.js --name outbook-backend
```

## ğŸ“„ è®¸å¯è¯

MIT

